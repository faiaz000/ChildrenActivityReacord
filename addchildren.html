<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>



  <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.css">
  <script>window.$ = window.jQuery = require('jquery');</script>
  <script src="node_modules/jquery/dist/jquery.js"></script>
  <!---<script src="node_modules/popper.js/dist/popper.js"></script>-->
  <script src="node_modules/bootstrap/dist/js/bootstrap.js"></script>



</head>

<body>
  <button id="back" class="btn">Back</button>
 
  <br>
  <br>

  <div class="container">
    <form>
      <div style ="float:left"class="container">
        <input class="form-control col-lg-3 col-md-3 "id="selecteddate" type="date">

      </div>
      

      <div class="container ">

        <h2>Add activity</h2>

        <textarea id="areaactivity" style="width:400px; height:200px" id="comment" rows="10"></textarea>
      </div>

      <div class="container">
        <button id="addtask" type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
          Submit
        </button>
      </div>
      
      <div class="modal" id="exampleModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Confirm Box</h5>
              <button id="dismisstop" type="button" class="close" data-dismiss="modal" aria-label="Close"></button>
              <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <h2>Activity</h2>
              <h4 id="dateheader"></h4>
              <h4 id="participants">Participants: </h4>
              <div id="grade1" class="container">
                  <h4>grade1</h4>
          
                </div>
                <div id="grade2" class="container">
                  <h4>grade2</h4>
          
                </div>
                <div id="grade3" class="container">
                  <h4>grade3</h4>
                </div>
                <div id="grade4" class="container">
                  <h4>grade4</h4>
          
                </div>
          
              <h2>Description</h2>
              
              <textarea style="width:400px; height:200px"id="activityparagraph"  id="comment" ></textarea>
            </div>
            <div class="modal-footer">


              <button id="confirm" class="btn btn-primary" style="float: right" data-dismiss="modal"
                type="submit">Confirm</button>


              <button id="dismiss" type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>

      </div>
    </form>

  </div>


  <script>


    //window.$ = window.jQuery = require('jquery')
    const electron = require('electron');
    const { ipcRenderer } = electron
    const Activity = require('./Activity');
    const dates = require('date-and-time')
    let showdate = 'today'
    var now = new Date();
    let showchildren=[];
    let childrenids=[];
    var peoplelist = [];
    let yesterday = dates.addDays(now, -1);
    let fromepisodes;
   
    document.getElementById('back').addEventListener('click',(e)=>{
      e.preventDefault();
     ipcRenderer.send('checkforbcakfromepisodes');
     
     
    });
    ipcRenderer.on('checkbackforepisodes',(e,f)=>{
      console.log(f) 
      fromepisodes =f 
      if(fromepisodes=="fromepisodes"){
        
        ipcRenderer.send('episodes')
        }
        else if (fromepisodes=="fromshowdetails"){

          ipcRenderer.send('showDetails',"")
        }
       else if (fromepisodes=="fromquery"){
         ipcRenderer.send('loadquery')
       }
        else { 
          ipcRenderer.send('back')
        }
      });
  
    window.onload = function () {

     ipcRenderer.send('checkdate')
     ipcRenderer.on('showdate',(e,d)=>{
       showdate=d
       if(showdate=='yesterday'){
       
        document.getElementById('selecteddate').valueAsDate = yesterday
        
       }
       else{
        document.getElementById('selecteddate').valueAsDate = now

       }
     })
     ipcRenderer.send('activitywindowloaded')
   
    
     ipcRenderer.on('hello', (e, childrenlist) => {
       let testindex =0
       childrenlist.forEach((child) => {
         //console.log(child);
         
         let div = document.getElementById(child.grade)
         div.innerHTML += `<label class="checkbox-inline"><input id="${child.id}" name= "people" type="checkbox"  value="${child.name}"> ${child.name} </label>`
         showchildren.push(child.name)
        childrenids.push(child.id)
       })
       
     });
     
    }

   
   
    document.getElementById('addtask').addEventListener('click', () => {
    
      var selecteddate = document.getElementById('selecteddate').value
      document.getElementById('dateheader').innerText = "Selected Date : "+ selecteddate
      var text = document.getElementById('areaactivity').value
      document.getElementById('activityparagraph').innerText = text
      let index=0
      showchildren.forEach((item)=>{
        if(text.includes(item)){
          console.log('hello Adrian')
          document.getElementById(childrenids[index]).checked = true;
        }
        index++
      })
    })
   
    document.getElementById('dismiss').addEventListener('click', () => {
      document.getElementById('participants').innerText = ""
      peoplelist = [];
      $('input[type=checkbox]').each(function () {
        this.checked = false;
      });
    })
    document.getElementById('dismisstop').addEventListener('click', () => {
      document.getElementById('participants').innerText = ""
      peoplelist = [];
      $('input[type=checkbox]').each(function () {
        this.checked = false;
      });
    })

    document.getElementById('confirm').addEventListener('click', (e) => {
      e.preventDefault();
      $.each($("input[name='people']:checked"), function () {
        peoplelist.push($(this))
        document.getElementById('participants').innerText += ' ' + $(this).val();

      })
      var selecteddate = document.getElementById('selecteddate').value
      peoplelist.forEach((person) => {

        var student = person.attr('value')
        var id = person.attr('id')
        var description = document.getElementById('areaactivity').value
        var dateval = selecteddate
        var activity = new Activity(description, dateval, id)
        ipcRenderer.send('addactivity', activity);
      })
      peoplelist = [];
      $('input[type=checkbox]').each(function () {
        this.checked = false;
      });
      
    })
  </script>

</body>

</html>